name: Deploy to EC2

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    # √âtape 1 : R√©cup√©rer le code
    - name: Checkout code
      uses: actions/checkout@v4
    
    # √âtape 2 : Copier les fichiers sur EC2 dans /var/www/daniel
    - name: Copy files to EC2
      uses: appleboy/scp-action@v0.1.4
      with:
        host: ${{ secrets.EC2_HOST }}
        username: ${{ secrets.EC2_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        source: "."
        target: "/var/www/daniel"
    
    # √âtape 3 : Ex√©cuter les commandes sur EC2
    - name: Run deployment commands
      uses: appleboy/ssh-action@v0.1.5
      with:
        host: ${{ secrets.EC2_HOST }}
        username: ${{ secrets.EC2_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        script: |
          echo "üì¶ D√©but du d√©ploiement sur /var/www/daniel..."
          
          # Aller dans votre dossier d'application
          cd /var/www/daniel
          
          # V√©rifier les permissions
          echo "V√©rification des permissions..."
          sudo chown -R ubuntu:ubuntu /var/www/daniel
          
          # Afficher le contenu (pour v√©rification)
          echo "Contenu du dossier :"
          ls -la
          
          # V√©rifier que les fichiers sont bien copi√©s
          echo "‚úÖ Fichiers copi√©s dans /var/www/daniel !"
          
          # ICI : Vos commandes sp√©cifiques
          # Exemple pour Node.js : npm install && npm start
          # Exemple pour PHP : composer install
          
          echo "üöÄ Pr√©paration termin√©e. Configurez maintenant vos commandes d'installation."
